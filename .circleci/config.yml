version: 2.1
  notify_job_status:
    steps:
      - run:
          name: On success
          when: on_success
          command: |
                  curl -X POST -u $GITHUB_USER_TOKEN:x-oauth-basic -d '{"body": "'@${CIRCLE_PR_USERNAME}' Build Success!" }' 'https://api.github.com/repos/'${CIRCLE_PROJECT_USERNAME}'/'${CIRCLE_PROJECT_REPONAME}'/issues/'${CIRCLE_PR_NUMBER}'/comments'
               
      - run:
          name: On failure
          when: on_failure
          command: |
                  curl -X POST -u $GITHUB_USER_TOKEN:x-oauth-basic -d '{"body": "'@${CIRCLE_PR_USERNAME}' Build Failed, Please check" }' 'https://api.github.com/repos/'${CIRCLE_PROJECT_USERNAME}'/'${CIRCLE_PROJECT_REPONAME}'/issues/'${CIRCLE_PR_NUMBER}'/comments'

jobs:
  test-cases:
    docker:
      - image: golang:latest
    steps:
      - checkout
      - run:
          name: Install Dependencies
          command: 'apt update && apt install nodejs npm -y'
      - run:
          name: Install sonarqube scanner
          command: 'npm install -g sonarqube-scanner'
      - run:
          name: run the test cases
          command: 'go test -cover -coverprofile=c.out'
      - run:
          name: Generate the test cases
          command: 'go tool cover -html=c.out -o coverage.html'
      - run:
          name: send test case to sonarcloud
          command: 'sonar-scanner'
      - store_artifacts:
          path: coverage.html
          prefix: coverage

workflows:
  version: 2
  build_and_test:
    jobs:
      - test-cases
